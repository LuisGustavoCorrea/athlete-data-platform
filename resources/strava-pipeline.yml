resources:
  jobs:
    athlete_pipeline:
      name: strava-pipeline
      run_as:
        user_name: lgcpazdb892@outlook.com

      tasks:
        # -----------------------
        # BRONZE - ACTIVITIES
        # -----------------------
        - task_key: bronze_load_activities
          job_cluster_key: athlete_job_cluster
          notebook_task:
            notebook_path: ../src/notebooks/01_bronze_load.py
            base_parameters:
              1_input_path: "abfss://raw@adlsathlete.dfs.core.windows.net/strava/activities/"
              2_output_path: "abfss://bronze@adlsathlete.dfs.core.windows.net/strava/activities/"
              3_format_file: "json"
              4_checkpoint_path: "abfss://bronze@adlsathlete.dfs.core.windows.net/strava/activities/checkpoints/"
        - task_key: Silver_Activities 
          depends_on:
            - task_key: bronze_load_activities
          job_cluster_key: athlete_job_cluster
          notebook_task:
            notebook_path: ../src/notebooks/Silver_activities.py
            
        # -----------------------
        # BRONZE - ATHLETE
        # -----------------------
        - task_key: bronze_load_athlete
          job_cluster_key: athlete_job_cluster
          notebook_task:
            notebook_path: ../src/notebooks/01_bronze_load.py
            base_parameters:
              1_input_path: abfss://raw@adlsathlete.dfs.core.windows.net/strava/athlete/
              2_output_path: abfss://bronze@adlsathlete.dfs.core.windows.net/strava/athlete/
              3_format_file: json
              4_checkpoint_path: abfss://bronze@adlsathlete.dfs.core.windows.net/strava/athlete/checkpoints/

        # -----------------------
        # BRONZE + SILVER - SUB ACTIVITY
        # -----------------------
        - task_key: bronze_load_SubActivity  
          job_cluster_key: athlete_job_cluster
          notebook_task:
            notebook_path: ../src/notebooks/01_bronze_load.py
            base_parameters:
              1_input_path: abfss://raw@adlsathlete.dfs.core.windows.net/strava/sub_activity/
              2_output_path: abfss://bronze@adlsathlete.dfs.core.windows.net/strava/sub_activity/
              3_format_file: json
              4_checkpoint_path: abfss://bronze@adlsathlete.dfs.core.windows.net/strava/sub_activity/checkpoints/
        
        - task_key: Silver_SubActivity 
          depends_on:
            - task_key: bronze_load_SubActivity
          job_cluster_key: athlete_job_cluster
          notebook_task:
            notebook_path: ../src/notebooks/Silver_SubActivity.py            
      
      job_clusters:
        - job_cluster_key: athlete_job_cluster
          new_cluster:
            spark_version: "15.4.x-scala2.12"
            node_type_id: "Standard_DS3_v2"
            num_workers: 1
            # Se quiser autoscaling (recomendado), troque o bloco acima por:
            # autoscale:
            #   min_workers: 1
            #   max_workers: 3

            # Opcional (recomendado): runtime mais est√°vel e logs melhores
            spark_conf:
              "spark.databricks.delta.formatCheck.enabled": "false"      